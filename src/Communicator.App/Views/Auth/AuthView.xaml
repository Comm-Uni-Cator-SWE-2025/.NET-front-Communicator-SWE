<UserControl x:Class="Communicator.App.Views.Auth.AuthView" x:ClassModifier="public"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:icons="clr-namespace:Communicator.Icons;assembly=Communicator.Icons"
             xmlns:converters="clr-namespace:Communicator.Core.UX.Converters;assembly=Communicator.Core">
    
    <UserControl.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <converters:BooleanToVisibilityConverter x:Key="InverseBoolToVis"/>
        <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
        <converters:StringToVisibilityConverter x:Key="StringToVis"/>
    </UserControl.Resources>

    <Grid Background="{DynamicResource AppBackgroundBrush}">
        <!-- Centered Login Card -->
        <Border Background="{DynamicResource CardBackgroundBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="12"
                MaxWidth="420"
                Padding="48,56"
                VerticalAlignment="Center"
                HorizontalAlignment="Center">

            <StackPanel>
                <!-- Logo / Title -->
                <TextBlock Text="IIT Palakkad Meet"
                           FontSize="32"
                           FontWeight="Bold"
                           Foreground="{DynamicResource TextPrimaryBrush}"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,12"/>

                <TextBlock Text="Secure video conferencing for education"
                           FontSize="15"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           HorizontalAlignment="Center"
                           TextAlignment="Center"
                           Margin="0,0,0,48"/>

                <!-- Error Message -->
                <TextBlock Text="{Binding ErrorMessage}"
                           Foreground="#D32F2F"
                           FontSize="13"
                           TextWrapping="Wrap"
                           HorizontalAlignment="Center"
                           TextAlignment="Center"
                           Margin="0,0,0,12"
                           Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVis}}"/>

                <!-- Google Sign-In Button - Using SecondaryButtonStyle -->
                <Button Command="{Binding SignInWithGoogleCommand}"
                        AutomationProperties.AutomationId="SignInButton"
                        Style="{StaticResource SecondaryButtonStyle}"
                        Height="50"
                        Padding="16,0"
                        Margin="0,0,0,20"
                        IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <!-- Loading Spinner (visible when IsLoading is true) -->
                        <icons:Icon IconName="loader-2"
                                    IconSize="20"
                                    Foreground="{DynamicResource IconBrush}"
                                    Margin="0,0,12,0"
                                    VerticalAlignment="Center"
                                    Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}"
                                    RenderTransformOrigin="0.5, 0.5">
                            <icons:Icon.RenderTransform>
                                <RotateTransform x:Name="SpinnerRotate" Angle="0"/>
                            </icons:Icon.RenderTransform>
                            <icons:Icon.Triggers>
                                <EventTrigger RoutedEvent="Loaded">
                                    <BeginStoryboard>
                                        <Storyboard RepeatBehavior="Forever">
                                            <DoubleAnimation Storyboard.TargetName="SpinnerRotate"
                                                           Storyboard.TargetProperty="Angle"
                                                           From="0" To="360" Duration="0:0:1"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </icons:Icon.Triggers>
                        </icons:Icon>

                        <!-- Official Google Logo with brand colors (hidden when loading) -->
                        <icons:GoogleIcon Width="20" Height="20" Margin="0,0,12,0"
                                        Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}, ConverterParameter=Invert}"/>
                        
                        <TextBlock FontSize="15"
                                   FontWeight="Medium"
                                   VerticalAlignment="Center">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="Sign in with Google"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsLoading}" Value="True">
                                            <Setter Property="Text" Value="Signing in..."/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </StackPanel>
                </Button>

                <!-- Info Text -->
                <TextBlock Text="By signing in, you agree to use Google authentication for secure access to IIT Palakkad Meet."
                           FontSize="12"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           TextWrapping="Wrap"
                           HorizontalAlignment="Center"
                           TextAlignment="Center"
                           LineHeight="18"
                           Margin="0,32,0,0"
                           Opacity="0.7"/>

                <!-- Debug Login Button (Only visible in Debug) -->
                <Button Command="{Binding DebugLoginCommand}"
                        AutomationProperties.AutomationId="DebugLoginButton"
                        Content="Debug Login"
                        Height="30"
                        Margin="0,20,0,0"
                        Visibility="Visible"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>

