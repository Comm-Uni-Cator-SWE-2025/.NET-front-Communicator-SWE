<UserControl x:Class="Communicator.UX.Views.Meeting.ParticipantTileControl" x:ClassModifier="public"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:icons="clr-namespace:Communicator.Icons;assembly=Communicator.Icons"
             mc:Ignorable="d"
             d:DesignHeight="200"
             d:DesignWidth="200">
    <Border Background="#1E1E1E"
            BorderBrush="#3A3A3A"
            BorderThickness="1"
            CornerRadius="8"
            ClipToBounds="True">
        <Grid>
            <!-- Video/Screen Frame -->
            <Image Source="{Binding VideoFrame}"
                   Stretch="UniformToFill"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center">
                <Image.Style>
                    <Style TargetType="Image">
                        <Setter Property="Visibility" Value="Collapsed"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding HasVideoFrame}" Value="True">
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Image.Style>
            </Image>

            <!-- Fallback: Avatar (Initial Circle) -->
            <Grid>
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding HasVideoFrame}" Value="True">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Grid.Style>

                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <!-- Profile Image or Initial Circle -->
                    <Grid Width="80" Height="80">
                        <!-- Profile Image -->
                        <Ellipse>
                            <Ellipse.Fill>
                                <ImageBrush ImageSource="{Binding ProfileImageUri}"
                                            Stretch="UniformToFill"/>
                            </Ellipse.Fill>
                            <Ellipse.Style>
                                <Style TargetType="Ellipse">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ProfileImageUri}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Ellipse.Style>
                        </Ellipse>

                        <!-- Fallback: Initial Circle -->
                        <Border CornerRadius="40"
                                Background="{DynamicResource AccentBrush}">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ProfileImageUri}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <TextBlock Text="{Binding Initial}"
                                       FontSize="36"
                                       FontWeight="Bold"
                                       Foreground="White"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"/>
                        </Border>
                    </Grid>
                </StackPanel>
            </Grid>

            <!-- Overlay: Participant Info -->
            <Border Background="#99000000"
                    VerticalAlignment="Bottom"
                    Padding="8,4">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Participant Name -->
                    <TextBlock Grid.Column="0"
                               Text="{Binding DisplayName}"
                               FontSize="12"
                               FontWeight="Medium"
                               Foreground="White"
                               TextTrimming="CharacterEllipsis"
                               VerticalAlignment="Center"/>

                    <!-- Status Icons -->
                    <StackPanel Grid.Column="1"
                                Orientation="Horizontal"
                                Margin="8,0,0,0">
                        <!-- Hand Raised -->
                        <icons:Icon IconName="hand-paper"
                                    IconSize="14"
                                    Foreground="{DynamicResource WarningBrush}"
                                    Margin="4,0,0,0"
                                    ToolTip="Hand raised">
                            <icons:Icon.Style>
                                <Style TargetType="icons:Icon">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsHandRaised}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </icons:Icon.Style>
                        </icons:Icon>

                        <!-- Screen Sharing -->
                        <icons:Icon IconName="monitor"
                                    IconSize="14"
                                    Foreground="{DynamicResource SuccessBrush}"
                                    Margin="4,0,0,0"
                                    ToolTip="Screen sharing">
                            <icons:Icon.Style>
                                <Style TargetType="icons:Icon">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsScreenSharing}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </icons:Icon.Style>
                        </icons:Icon>

                        <!-- Microphone Muted -->
                        <icons:Icon IconName="microphone-off"
                                    IconSize="14"
                                    Foreground="{DynamicResource ErrorBrush}"
                                    Margin="4,0,0,0"
                                    ToolTip="Muted">
                            <icons:Icon.Style>
                                <Style TargetType="icons:Icon">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsMuted}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </icons:Icon.Style>
                        </icons:Icon>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</UserControl>

