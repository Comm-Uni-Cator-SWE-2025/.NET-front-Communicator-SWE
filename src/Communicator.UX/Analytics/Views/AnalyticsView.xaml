<UserControl x:Class="Communicator.UX.Analytics.Views.AnalyticsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:wpf="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
             xmlns:icons="clr-namespace:Communicator.Icons;assembly=Communicator.Icons"
             Background="{DynamicResource AppBackgroundBrush}">

    <UserControl.Resources>
        <Style x:Key="AnalyticsCardStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Background" Value="{DynamicResource CardBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.1" Color="Black"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="AnalyticsTitleStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="8,0,0,0"/>
        </Style>
    </UserControl.Resources>

    <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MinWidth="300"/>
                <ColumnDefinition Width="*" MinWidth="300"/>
            </Grid.ColumnDefinitions>

            <!-- GRAPH 1: AI Analysis -->
            <Border Grid.Row="0" Grid.Column="0" Style="{StaticResource AnalyticsCardStyle}" Height="300">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <icons:Icon IconName="activity" IconSize="20" Foreground="{DynamicResource IconBrush}"/>
                        <TextBlock Text="AI Analysis" Style="{StaticResource AnalyticsTitleStyle}"/>
                    </StackPanel>

                    <wpf:CartesianChart
                        Grid.Row="1"
                        Series="{Binding Graph1_AI.Series}"
                        XAxes="{Binding Graph1_AI.XAxes}"
                        YAxes="{Binding Graph1_AI.YAxes}"
                        ZoomMode="X"/>
                </Grid>
            </Border>

            <!-- GRAPH 2: Canvas Activity -->
            <Border Grid.Row="0" Grid.Column="1" Style="{StaticResource AnalyticsCardStyle}" Height="300">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <icons:Icon IconName="pen-tool" IconSize="20" Foreground="{DynamicResource IconBrush}"/>
                        <TextBlock Text="Canvas Activity" Style="{StaticResource AnalyticsTitleStyle}"/>
                    </StackPanel>

                    <wpf:CartesianChart
                        Grid.Row="1"
                        Series="{Binding Graph2_Canvas.Series}"
                        XAxes="{Binding Graph2_Canvas.XAxes}"
                        YAxes="{Binding Graph2_Canvas.YAxes}"/>

                    <!-- Legend -->
                    <Border Background="{DynamicResource SurfaceBrush}"
                            BorderBrush="{DynamicResource BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="8"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Margin="0,0,10,0"
                            Opacity="0.9">
                        <StackPanel>
                            <TextBlock Text="Legend" FontSize="12" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryBrush}" Margin="0,0,0,4"/>
                            <TextBlock Text="■ FreeHand" FontSize="11" Foreground="LightSkyBlue"/>
                            <TextBlock Text="■ Straight Line" FontSize="11" Foreground="Brown"/>
                            <TextBlock Text="■ Rectangle" FontSize="11" Foreground="Green"/>
                            <TextBlock Text="■ Ellipse" FontSize="11" Foreground="Blue"/>
                            <TextBlock Text="■ Triangle" FontSize="11" Foreground="BlueViolet"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- MESSAGE LIST -->
            <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource AnalyticsCardStyle}" Height="300">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <icons:Icon IconName="message-square" IconSize="20" Foreground="{DynamicResource IconBrush}"/>
                        <TextBlock Text="AI Messages" Style="{StaticResource AnalyticsTitleStyle}"/>
                    </StackPanel>
                    
                    <ListBox x:Name="AI_Message" 
                             Grid.Row="1"
                             ItemsSource="{Binding MessageList}" 
                             FontSize="14"
                             Background="{DynamicResource SurfaceBrush}" 
                             BorderBrush="{DynamicResource BorderBrush}" 
                             BorderThickness="1" 
                             Foreground="{DynamicResource TextPrimaryBrush}"
                             Padding="8">
                         <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Padding" Value="4"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListBoxItem">
                                            <Border x:Name="Bd" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="true">
                                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Bd" Property="Background" Value="{DynamicResource HoverOverlayBrush}"/>
                                                </Trigger>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter TargetName="Bd" Property="Background" Value="{DynamicResource ActiveOverlayBrush}"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                         </ListBox.ItemContainerStyle>
                    </ListBox>
                </Grid>
            </Border>

            <!-- SCREEN SHARE -->
            <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource AnalyticsCardStyle}" Height="300">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <icons:Icon IconName="monitor" IconSize="20" Foreground="{DynamicResource IconBrush}"/>
                        <TextBlock Text="Screen Share Usage" Style="{StaticResource AnalyticsTitleStyle}"/>
                    </StackPanel>

                    <wpf:CartesianChart
                        Grid.Row="1"
                        Series="{Binding Graph4_Screen.Series}"
                        XAxes="{Binding Graph4_Screen.XAxes}"
                        YAxes="{Binding Graph4_Screen.YAxes}"
                        ZoomMode="X"/>
                </Grid>
            </Border>

        </Grid>
    </ScrollViewer>

</UserControl>
